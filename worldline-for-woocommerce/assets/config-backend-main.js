!function(){"use strict";var e={};function o(e,o){(null==o||o>e.length)&&(o=e.length);for(var t=0,n=Array(o);t<o;t++)n[t]=e[t];return n}function t(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,o,t,n,r,c,l){try{var i=e[c](l),a=i.value}catch(e){return void t(e)}i.done?o(a):Promise.resolve(a).then(n,r)}function r(e){return function(){var o=this,t=arguments;return new Promise((function(r,c){var l=e.apply(o,t);function i(e){n(l,r,c,i,a,"next",e)}function a(e){n(l,r,c,i,a,"throw",e)}i(void 0)}))}}e.n=function(o){var t=o&&o.__esModule?function(){return o.default}:function(){return o};return e.d(t,{a:t}),t},e.d=function(o,t){for(var n in t)e.o(t,n)&&!e.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:t[n]})},e.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)};var c=window.regeneratorRuntime,l=e.n(c),i=function(e){return"string"==typeof e?document.querySelector(e):e},a=function(e,o){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=i(e);if(n){var r=n.style.getPropertyValue("display");if(o)"none"===r&&n.style.removeProperty("display"),function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}(n)||n.style.setProperty("display","block");else{if("none"===r)return;n.style.setProperty("display","none",t?"important":"")}}},d=function(e,o,t){var n=i(e);n&&(o?n.classList.remove(t):n.classList.add(t))};function u(e){var o,t=document.querySelector(e);return null!==(o=null==t?void 0:t.closest("tr"))&&void 0!==o?o:null}function s(e,o){var t,n=document.querySelector(".wlop-logo-preview"),r=document.querySelector(".wlop-logo-delete"),c=document.querySelector("#woocommerce_worldline-for-woocommerce_logo_url");n&&r&&c&&(c.value=o?"":e,o&&(n.src=null!==(t=n.dataset.defaultUrl)&&void 0!==t?t:"",n.style.display="block",r.style.display="none"),!o&&e&&(n.src=e,n.style.display="block",r.style.display="inline-block"),o||e||(n.src="",n.style.display="none",r.style.display="none"))}function m(){return(m=r(l().mark((function e(){var o,t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,jQuery.ajax({type:"post",dataType:"json",url:"/wp-admin/admin-ajax.php",data:{action:"wlop_hosted_tokenization_config"}});case 3:(o=e.sent).success&&o.data.logo_url?(s(o.data.logo_url,o.data.is_default),(t=document.querySelector("#woocommerce_worldline-for-woocommerce_logo_url"))&&(t.value=o.data.logo_url)):s("",!0),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to fetch logo URL:",e.t0),s("",!0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function p(){var e=document.querySelector("#woocommerce_worldline-for-woocommerce_logo_url");e&&(e.value="",e.dispatchEvent(new Event("change"))),s("",!0)}function w(){return document.querySelectorAll(".wlop-additional-webhook-field")}function f(e){var o=w(),t=document.querySelector(".woocommerce-save-button"),n=!1;o.forEach((function(e){var o=e.value.trim(),t=""===o||function(e){try{if(!e.startsWith("https://"))return!1;var o=new URL(e).hostname;if(!o.includes("."))return!1;var t=o.split(".");return t[t.length-1].length>=1}catch(e){return!1}}(o);t?e.classList.remove("wlop-input-error"):(e.classList.add("wlop-input-error"),n=!0)})),function(e,o){var t=u("#woocommerce_worldline-for-woocommerce_additional_webhook_url_4");if(t){var n=document.querySelector(".wlop-global-webhook-error"),r=t.parentElement;if(e){n||((n=document.createElement("tr")).className="wlop-global-webhook-error",n.innerHTML='\n\t\t\t\t<th scope="row"></th>\n\t\t\t\t<td class="forminp">\n\t\t\t\t\t<p class="wlop-webhook-error-message">'.concat(o,"</p>\n\t\t\t\t</td>\n\t\t\t"),r&&r.insertBefore(n,t.nextSibling)),n.style.display="table-row";var c=n.querySelector("p");c&&(c.textContent=o)}else n&&(n.style.display="none")}}(n,wp.i18n.__("Please enter a valid HTTPS URL (max 325 characters)","worldline-for-woocommerce")),t&&(t.disabled=n)}function _(){var e=document.querySelector("#woocommerce_worldline-hosted-tokenization_custom_icons");if(!e||!e.value)return[];try{return JSON.parse(e.value)}catch(e){return console.error("Failed to parse custom icons:",e),[]}}function y(e){var o=document.querySelector("#woocommerce_worldline-hosted-tokenization_custom_icons");o&&(o.value=JSON.stringify(e))}function h(){var e=document.getElementById("wlop-custom-icons-grid");if(e){var o=_();0!==o.length?(e.innerHTML=o.map((function(e){return'\n\t\t\t\t\t<div class="wlop-custom-icon-item" data-icon-id="'.concat(e.id,'">\n\t\t\t\t\t\t<img src="').concat(e.url,'" alt="').concat(e.title,'" class="wlop-custom-icon-image" />\n\t\t\t\t\t\t<button type="button" class="wlop-custom-icon-delete" aria-label="Delete ').concat(e.title,'">\n\t\t\t\t\t\t\t<span class="dashicons dashicons-no-alt"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<span class="wlop-custom-icon-title">').concat(e.title,"</span>\n\t\t\t\t\t</div>\n\t\t\t\t")})).join(""),e.querySelectorAll(".wlop-custom-icon-delete").forEach((function(e){e.addEventListener("click",v)}))):e.innerHTML=""}}function v(e){var o=e.currentTarget.closest(".wlop-custom-icon-item");if(o){var t=parseInt(o.getAttribute("data-icon-id")||"0");if(t){y(_().filter((function(e){return e.id!==t}))),h();var n=document.querySelector("#woocommerce_worldline-hosted-tokenization_custom_icons");null==n||n.dispatchEvent(new Event("change"))}}}document.addEventListener("DOMContentLoaded",(function(){var e,o=document.querySelector("#woocommerce_worldline-for-woocommerce_live_mode"),n=document.querySelector("#woocommerce_worldline-for-woocommerce_authorization_mode"),c=document.querySelector("#woocommerce_worldline-for-woocommerce_enable_3ds"),i=document.querySelector("#woocommerce_worldline-for-woocommerce_request_3ds_exemption"),v=document.querySelector("#woocommerce_worldline-for-woocommerce_3ds_exemption_type"),g=document.querySelector("#woocommerce_worldline-for-woocommerce_3ds_exemption_limit"),b=null,k={},S=document.querySelector("#woocommerce_worldline-for-woocommerce_webhook_mode_is_automatic"),q=document.querySelector("#wlop-webhook-mode-warning"),L=document.querySelector(".wlop-button-copy.wlop-manual-mode-only");function E(){if(o){var e=o.checked;d(u("#woocommerce_worldline-for-woocommerce_live_api_key"),e,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_live_api_secret"),e,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_live_api_endpoint"),e,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_live_webhook_id"),e,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_live_webhook_secret_key"),e,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_test_api_key"),!e,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_test_api_secret"),!e,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_test_api_endpoint"),!e,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_test_webhook_id"),!e,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_test_webhook_secret_key"),!e,"wlop-hidden"),d(u("#wlopLiveAccountNote"),e,"wlop-hidden"),a("#wlopTestCreateAccountLink",!e),a("#wlopLiveCreateAccountLink",e),a("#wlopTestViewAccountLink",!e),a("#wlopLiveViewAccountLink",e)}}function x(){n&&(d(u("#woocommerce_worldline-for-woocommerce_credit_card_authorization_mode"),"authorization"===n.value,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_capture_mode"),"authorization"===n.value,"wlop-hidden"))}function j(){c&&(d(u("#woocommerce_worldline-for-woocommerce_enforce_3dsv2"),c.checked,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_request_3ds_exemption"),c.checked,"wlop-hidden"),i&&(d(u("#woocommerce_worldline-for-woocommerce_3ds_exemption_type"),c.checked&&i.checked,"wlop-hidden"),d(u("#woocommerce_worldline-for-woocommerce_3ds_exemption_limit"),c.checked&&i.checked,"wlop-hidden"),d("#woocommerce_worldline-for-woocommerce_3ds_exemption_warning",c.checked&&i.checked,"wlop-hidden")))}function A(){if(v&&g){var e=v.value,o=g.value;b&&b!==e&&(k[b]=o);var t,n,r="transaction-risk-analysis"===(t=e)||"none"===t?100:30;if(e in k)n=k[e];else if(null===b)n=o;else{var c=parseFloat(o);n=isNaN(c)||c>r?r.toString():o}g.setAttribute("max",r.toString()),g.value=n,b=e;var l=document.querySelector(".wlop-tra-warning");l&&d(l.closest("tr"),"transaction-risk-analysis"===e,"wlop-hidden")}}function T(){if(S&&q){var e=S.checked;q.innerHTML="\n    \t\t<p>".concat(wp.i18n.__("Automatic: The URL(s) below will be used for transactions from this store, any webhook URL(s) configured in the merchant portal will be ignored.<br>Manual: You are fully responsible for adding your store webhook URL in the merchant portal. Failure to do so could result in missing or incomplete orders!","worldline-for-woocommerce"),"</p>\n\t\t"),q.className="wlop-warning-field",document.querySelectorAll(".wlop-additional-webhook-field").forEach((function(o){d(u("#".concat(o.id)),e,"wlop-hidden")}));var o=document.querySelector(".wlop-global-webhook-error");o&&d(o,e,"wlop-hidden"),L&&d(L.closest("button"),!e,"wlop-hidden")}}function C(){return(C=r(l().mark((function e(o,t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(t.value);case 3:n=o.textContent,o.textContent=o.dataset.copiedMessage,o.disabled=!0,setTimeout((function(){o.disabled=!1,o.textContent=n}),1e3),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),alert("Failed to copy, please select the address and copy it manually.");case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}null==o||o.addEventListener("click",E),null==n||n.addEventListener("change",x),null==c||c.addEventListener("click",j),null==i||i.addEventListener("click",j),null==v||v.addEventListener("change",A),null==S||S.addEventListener("click",T),d(u("#woocommerce_worldline-for-woocommerce_logo_url"),!1,"wlop-hidden"),E(),x(),j(),A(),T(),0!==(e=document.querySelectorAll(".wlop-button-copy")).length&&e.forEach((function(e){var o=e.dataset.copy,t=document.querySelector(o);t?e.addEventListener("click",(function(){return function(_x,e){return C.apply(this,arguments)}(e,t)})):console.error("Can't copy the value from field. The field doesn't exist.")})),function(){var e=document.querySelector(".wlop-logo-upload-button"),o=document.querySelector(".wlop-logo-delete"),t=document.querySelector(".wlop-logo-controls");if(e&&o&&t){var n=document.createElement("input");n.type="file",n.accept="image/png, image/gif, image/jpeg",n.style.display="none",document.body.appendChild(n),e.addEventListener("click",(function(){n.click()})),n.addEventListener("change",(function(e){var o,t,n=e.target;n.files&&n.files[0]&&(o=n.files[0],(t=new FormData).append("action","wlop_hosted_tokenization_config"),t.append("logo_file",o),jQuery.ajax({type:"post",url:"/wp-admin/admin-ajax.php",data:t,contentType:!1,processData:!1,success:function(e){if(e.success&&e.data.logo_url){s(e.data.logo_url,e.data.is_default);var o=document.querySelector("#woocommerce_worldline-for-woocommerce_logo_url");o&&(o.value=e.data.logo_url,o.dispatchEvent(new Event("change")))}else alert(e.data.message)},error:function(){alert("Failed to upload logo.")}}))})),o.addEventListener("click",p)}}(),function(){m.apply(this,arguments)}(),w().forEach((function(e){e.addEventListener("blur",f),e.addEventListener("keyup",f),f()})),function(){console.log("Initializing custom icons controls...");var e=document.querySelector(".wlop-custom-icons-upload-button"),o=document.querySelector(".wlop-custom-icons-wrapper");if(e&&o){var n=document.createElement("input");n.type="file",n.accept="image/png, image/gif, image/jpeg, image/svg+xml",n.multiple=!0,n.style.display="none",document.body.appendChild(n),e.addEventListener("click",(function(e){console.log("Upload button clicked"),e.preventDefault(),n.click()})),n.addEventListener("change",(function(e){console.log("File input changed");var o=e.target;o.files&&function(e){if(0!==e.length){var o=new FormData;o.append("action","wlop_upload_custom_icon"),Array.from(e).forEach((function(e,t){o.append("icon_files[".concat(t,"]"),e)})),jQuery.ajax({type:"post",url:"/wp-admin/admin-ajax.php",data:o,contentType:!1,processData:!1,success:function(e){if(e.success&&e.data.icons){var o=_();console.log("Current icons before upload:",o);var n=e.data.icons;console.log("New icons from backend:",n),y([].concat(t(o),t(n))),h();var r=document.querySelector("#woocommerce_worldline-hosted-tokenization_custom_icons");null==r||r.dispatchEvent(new Event("change"))}else alert(e.data.message||"Failed to upload icons.")},error:function(){alert("Failed to upload icons.")}})}}(o.files)})),console.log("Loading custom icons..."),jQuery.ajax({type:"post",url:"/wp-admin/admin-ajax.php",data:{action:"wlop_get_custom_icons"},success:function(e){e.success&&e.data.icons&&(y(e.data.icons),h())},error:function(){console.error("Failed to load custom icons")}})}else console.log("Required elements not found")}()}))}();