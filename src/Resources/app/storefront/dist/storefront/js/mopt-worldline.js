"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["mopt-worldline"],{2684:(e,t,n)=>{var i=n(8254),r=n(6285);class o extends r.Z{init(){if(null!==document.getElementById("moptWorldlinePageId")){if(this.page=document.getElementById("moptWorldlinePageId").value,this._client=new i.Z,"cartConfirm"===this.page){this.changePaymentForm=document.getElementById("changePaymentForm"),this.changePaymentForm.addEventListener("change",(e=>{e.preventDefault(),this._changePaymentForm()})),this.moptWorldlineSalesChannel=document.getElementById("moptWorldlineSalesChannelId"),this.moptWorldlineLocaleId=document.getElementById("moptWorldlineLocaleId"),this._client.get("/worldline_serverUrl?serverUrl="+document.URL);let e=document.getElementById("moptWorldlineShowIframe");null!==e&&e.value&&("1"===this._isRedirectToken()?this._initRedirectTokenMethod():this._initIframe()),this._setWorldLineOrderFormSubmitOverride(),this._client.get("/worldline_cardToken?worldline_cardToken=")}"account"===this.page&&(this.changeAccountPaymentForm=document.getElementById("moptWorldlinePageId").form,this.changeAccountPaymentForm.addEventListener("submit",(e=>{e.preventDefault(),this._changeAccountPaymentForm()})),this._client.get("/worldline_accountCardToken?worldline_accountCardToken="))}}_initIframe(){this.tokenizationDiv="div-hosted-tokenization",this.savePaymentCardCheckbox=document.getElementById("moptWorldlineSavePaymentCard"),this.salesChannelId=this.moptWorldlineSalesChannel.value,this.localeId=this.moptWorldlineLocaleId.value;const e=this._getCurrentToken();this._client.get("/worldline_iframe?salesChannelId="+this.salesChannelId+"&token="+e+"&localeId="+this.localeId,this._setContent.bind(this),"application/json",!0)}_setContent(e){this.tokenizer=new Tokenizer(JSON.parse(e).url,this.tokenizationDiv,{hideCardholderName:!1,hideTokenFields:!0},this._getCurrentToken()),this.tokenizer.initialize()}_confirmOrderFormForIFrame(){const e=!!this.savePaymentCardCheckbox&&this.savePaymentCardCheckbox.checked;this.tokenizer.submitTokenization({storePermanently:e}).then((e=>{e.success&&(this._createHiddenInput(this.confirmForm,"moptWorldlineHostedTokenizationId",e.hostedTokenizationId),this.confirmForm.submit())}))}_setWorldLineOrderFormSubmitOverride(){this.confirmForm=document.getElementById("confirmOrderForm"),this.confirmForm.addEventListener("submit",(e=>{e.preventDefault(),this._setHiddenInputs();let t=document.getElementById("moptWorldlineShowIframe");null!==t&&t.value&&"1"!==this._isRedirectToken()?this._confirmOrderFormForIFrame():this.confirmForm.submit()}))}_setHiddenInputs(){this._createHiddenInput(this.confirmForm,"moptWorldlineBrowserDataColorDepth",screen.colorDepth),this._createHiddenInput(this.confirmForm,"moptWorldlineBrowserDataScreenHeight",screen.height),this._createHiddenInput(this.confirmForm,"moptWorldlineBrowserDataScreenWidth",screen.width),this._createHiddenInput(this.confirmForm,"moptWorldlineBrowserDataJavaEnabled",navigator.javaEnabled()),this._createHiddenInput(this.confirmForm,"moptWorldlineLocale",this.moptWorldlineLocaleId.value),this._createHiddenInput(this.confirmForm,"moptWorldlineUserAgent",navigator.userAgent),this._createHiddenInput(this.confirmForm,"moptWorldlineTimezoneOffsetUtcMinutes",(new Date).getTimezoneOffset())}_initRedirectTokenMethod(){this.confirmForm=document.getElementById("confirmOrderForm"),this._createHiddenInput(this.confirmForm,"moptWorldlineRedirectToken",this._getCurrentToken())}_createHiddenInput(e,t,n){let i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name",t),i.setAttribute("value",n),e.appendChild(i)}_changePaymentForm(){let e=this._getCurrentToken();this._client.get("/worldline_cardToken?worldline_cardToken="+e);let t=!0,n=document.getElementById("moptWorldlineShowIframe");null!==n&&n.value&&null!==this.savePaymentCardCheckbox&&(t=!this.savePaymentCardCheckbox.checked),t&&this.changePaymentForm.submit()}_getCurrentToken(){let e=document.querySelector("#changePaymentForm input:checked"),t=e?e.attributes.rel:"";return t?t.value:""}_isRedirectToken(){let e=document.querySelector("#changePaymentForm input:checked"),t=e?e.attributes.redirect:"";return t?t.value:""}_getPaymentProductId(){let e=document.querySelector("#changePaymentForm input:checked"),t=e?e.attributes.product:"";return t?t.value:""}_changeAccountPaymentForm(){const e=this._getCurrentAccountToken();this._client.get(`/worldline_accountCardToken?worldline_accountCardToken=${e}`,this._submit.bind(this),"application/json",!0)}_submit(e){this.changeAccountPaymentForm.submit()}_getCurrentAccountToken(){let e=document.getElementById("moptWorldlinePageId").form.querySelector("input:checked"),t=e?e.attributes.rel:"";return t?t.value:""}}window.PluginManager.register("WorldlineIframePlugin",o)}},e=>{e.O(0,["vendor-node","vendor-shared"],(()=>{return t=2684,e(e.s=t);var t}));e.O()}]);