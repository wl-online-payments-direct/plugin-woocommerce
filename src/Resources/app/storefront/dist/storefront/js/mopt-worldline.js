"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["mopt-worldline"],{2684:(e,t,n)=>{var r=n(8254),i=n(6285);class o extends i.Z{init(){if(null!==document.getElementById("moptWorldlinePageId")){if(this.page=document.getElementById("moptWorldlinePageId").value,this._client=new r.Z,"cartConfirm"===this.page){this.changePaymentForm=document.getElementById("changePaymentForm"),this.changePaymentForm.addEventListener("change",(e=>{e.preventDefault(),this._changePaymentForm()})),this.moptWorldlineSalesChannel=document.getElementById("moptWorldlineSalesChannelId"),this._client.get("/worldline_serverUrl?serverUrl="+document.URL);var e=document.getElementById("moptWorldlineShowIframe");null!==e&&e.value&&("1"===this._isRedirectToken()?this._initRedirectTokenMethod():this._initIframe()),this._client.get("/worldline_cardToken?worldline_cardToken=")}"account"===this.page&&(this.changeAccountPaymentForm=document.getElementById("moptWorldlinePageId").form,this.changeAccountPaymentForm.addEventListener("submit",(e=>{e.preventDefault(),this._changeAccountPaymentForm()})),this._client.get("/worldline_accountCardToken?worldline_accountCardToken="))}}_initIframe(){this.tokenizationDiv="div-hosted-tokenization",this.savePaymentCardCheckbox=document.getElementById("moptWorldlineSavePaymentCard"),this.salesChannelId=this.moptWorldlineSalesChannel.value,this.confirmForm=document.getElementById("confirmOrderForm");var e=this._getCurrentToken();this._client.get("/worldline_iframe?salesChannelId="+this.salesChannelId+"&token="+e,this._setContent.bind(this),"application/json",!0),this.confirmForm.addEventListener("submit",(e=>{e.preventDefault(),this._confirmOrderForm()}))}_setContent(e){this.tokenizer=new Tokenizer(JSON.parse(e).url,this.tokenizationDiv,{hideCardholderName:!1,hideTokenFields:!0},this._getCurrentToken()),this.tokenizer.initialize()}_confirmOrderForm(){var e=!!this.savePaymentCardCheckbox&&this.savePaymentCardCheckbox.checked;this.tokenizer.submitTokenization({storePermanently:e}).then((e=>{e.success&&(this._createHiddenInput(this.confirmForm,"moptWorldlineHostedTokenizationId",e.hostedTokenizationId),this._createHiddenInput(this.confirmForm,"moptWorldlineBrowserDataColorDepth",screen.colorDepth),this._createHiddenInput(this.confirmForm,"moptWorldlineBrowserDataScreenHeight",screen.height),this._createHiddenInput(this.confirmForm,"moptWorldlineBrowserDataScreenWidth",screen.width),this._createHiddenInput(this.confirmForm,"moptWorldlineBrowserDataJavaEnabled",navigator.javaEnabled()),this._createHiddenInput(this.confirmForm,"moptWorldlineLocale",navigator.language),this._createHiddenInput(this.confirmForm,"moptWorldlineUserAgent",navigator.userAgent),this._createHiddenInput(this.confirmForm,"moptWorldlineTimezoneOffsetUtcMinutes",(new Date).getTimezoneOffset()),this.confirmForm.submit())}))}_initRedirectTokenMethod(){this.confirmForm=document.getElementById("confirmOrderForm"),this._createHiddenInput(this.confirmForm,"moptWorldlineRedirectToken",this._getCurrentToken())}_createHiddenInput(e,t,n){var r=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}_changePaymentForm(){var e=this._getCurrentToken();this._client.get("/worldline_cardToken?worldline_cardToken="+e);var t=!0,n=document.getElementById("moptWorldlineShowIframe");null!==n&&n.value&&null!==this.savePaymentCardCheckbox&&(t=!this.savePaymentCardCheckbox.checked),t&&this.changePaymentForm.submit()}_getCurrentToken(){var e=document.querySelector("#changePaymentForm input:checked"),t=e?e.attributes.rel:"";return t?t.value:""}_isRedirectToken(){var e=document.querySelector("#changePaymentForm input:checked"),t=e?e.attributes.redirect:"";return t?t.value:""}_getPaymentProductId(){var e=document.querySelector("#changePaymentForm input:checked"),t=e?e.attributes.product:"";return t?t.value:""}_changeAccountPaymentForm(){var e=this._getCurrentAccountToken();this._client.get("/worldline_accountCardToken?worldline_accountCardToken="+e,this._submit.bind(this),"application/json",!0)}_submit(e){this.changeAccountPaymentForm.submit()}_getCurrentAccountToken(){var e=document.getElementById("moptWorldlinePageId").form.querySelector("input:checked"),t=e?e.attributes.rel:"";return t?t.value:""}}window.PluginManager.register("WorldlineIframePlugin",o)}},e=>{e.O(0,["vendor-node","vendor-shared"],(()=>{return t=2684,e(e.s=t);var t}));e.O()}]);